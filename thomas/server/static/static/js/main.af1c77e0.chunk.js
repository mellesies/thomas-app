(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{119:function(e,t,n){},120:function(e,t,n){},121:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(41),i=n.n(a),s=(n(48),n(9)),c=n(10),u=n(12),l=n(11),d=(n(49),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(s.a)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).onChange=function(t){e.props.onNetworkSelected(t.target.value)},e}return Object(c.a)(n,[{key:"renderOptions",value:function(){return this.props.networks.map((function(e){return o.a.createElement("option",{key:e.id,value:e.id},e.name)}))}},{key:"render",value:function(){return o.a.createElement("div",{className:"Header"},o.a.createElement("div",{className:"top"},o.a.createElement("div",{className:"left"},o.a.createElement("span",{className:"h1"},"Thomas"),"\xa0 A Bayesian Network viewer."),o.a.createElement("div",{className:"right"},o.a.createElement("a",{href:"https://github.com/mellesies/thomas-app"},"Github"))),o.a.createElement("select",{onChange:this.onChange},this.renderOptions()))}}]),n}(r.Component)),h=(n(50),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return o.a.createElement("div",{className:"Footer"},"Copyright \xa9 2020 Melle Sieswerda. All rights reserved.")}}]),n}(r.Component)),f=n(22),p=n(15),g=n(7),v=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;Object(s.a)(this,n),(r=t.call(this,e)).onDragMove=function(e){var t=e.target.x(),n=e.target.y();r.setPosition(t,n),r.props.onDragMove&&r.props.onDragMove(r.RV,t,n)},r.onDragEnd=function(e){var t=e.target.x(),n=e.target.y();r.props.onDragEnd&&r.props.onDragEnd(r.RV,t,n)},r.onStateToggled=function(e){r.props.onStateToggled&&r.props.onStateToggled(r.RV,e)},r.RV=e.node.RV,r.titleHeight=15,r.stateOffset=8,r.stateHeight=14,r.statePadding=2,r.width=180,r.height=r.computeHeight();var o=e.node.position[0],a=e.node.position[1];return r.setPosition(o,a),r}return Object(c.a)(n,[{key:"createStates",value:function(e,t,n){var r=this,a=this.width,i=a-70-55;return e.states.map((function(e,s){var c=r.titleHeight+r.stateOffset+s*r.stateHeight,u="...",l=0,d="#003366";return n&&n===e&&(d="#00BCCC"),t&&(u=(100*t[e]).toFixed(2)+"%",l=1+i*t[e]),o.a.createElement(g.Group,{key:e,y:c,onDblClick:function(t){return r.onStateToggled(e)}},o.a.createElement(g.Label,null,o.a.createElement(g.Tag,null),o.a.createElement(g.Text,{text:e,padding:r.statePadding,fontSize:r.stateHeight-r.statePadding,wrap:"none",ellipsis:"ellipsis",width:70})),o.a.createElement(g.Rect,{x:70,y:1,width:l,height:r.stateHeight-2,fill:d}),o.a.createElement(g.Label,{x:a-55},o.a.createElement(g.Tag,null),o.a.createElement(g.Text,{text:u,padding:r.statePadding,fontSize:r.stateHeight-r.statePadding,align:"right",wrap:"none",width:55})))}))}},{key:"computeHeight",value:function(){return this.props.node.states.length*this.stateHeight+2*this.stateOffset+this.titleHeight}},{key:"setPosition",value:function(e,t){var n=this.width,r=this.height;this.x=e,this.y=t,this.center={x:e+n/2,y:t+r/2},this.corners={tl:{x:e,y:t},tr:{x:e+n,y:t},bl:{x:e,y:t+r},br:{x:e+n,y:t+r}}}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.query,r=e.probabilities,a=this.x,i=this.y,s=this.width,c=this.height,u=this.createStates(t,r,n);return o.a.createElement(g.Group,{x:a,y:i,width:s,height:c,onDragMove:this.onDragMove,onDragEnd:this.onDragEnd,draggable:!0},o.a.createElement(g.Rect,{fill:"#efefef",width:s,height:c,cornerRadius:5,shadowBlur:5}),o.a.createElement(g.Label,null,o.a.createElement(g.Tag,null),o.a.createElement(g.Text,{text:t.name,padding:4,fontSize:this.titleHeight,fontStyle:"bold",width:s})),u)}}]),n}(r.Component),m=n(17),k=n.n(m),y=n(42),w=n.n(y),E=new(function(){function e(){Object(s.a)(this,e),this._axios=null,this._user=!1}return Object(c.a)(e,[{key:"init",value:function(e){var t=this;this._config=e,this._axios=k.a.create(e),this._axios.interceptors.request.use((function(e){return e.headers.Authorization="Bearer "+localStorage.getItem("access_token"),e})),w()(this._axios,(function(e){return t.refreshAuthLogic(e)})),this.request=this._axios.request}},{key:"refreshAuthLogic",value:function(e){k.a.create(this._conifg).post("/token/refresh").then((function(t){var n,r=t.data.access_token;return n=r,localStorage.setItem("access_token",n),e.response.config.headers.Authorization="Bearer ".concat(r),Promise.resolve()}))}},{key:"_request",value:function(e){return console.log("Api::request()",e),this._axios.request(e).then((function(e){return e.data}))}},{key:"getVersion",value:function(){return this._request({url:"/version",method:"GET"})}},{key:"getNetworks",value:function(){return console.log("Api::getNetworks()"),this._request({url:"/network",method:"GET"})}},{key:"getNetwork",value:function(e){return this._request({url:"/network/".concat(e),method:"GET"})}},{key:"saveNetwork",value:function(e,t){return this._request({url:"/network/".concat(e),method:"POST",data:t})}},{key:"queryNetwork",value:function(e,t){var n={id:e,query:Object(p.a)({},t)};return this._request({url:"/network/_query",data:n,method:"POST"})}}]),e}());n(119);function b(e){var t=e.src,n=e.dst;return o.a.createElement(g.Arrow,{x:0,y:0,points:[t.x,t.y,n.x,n.y],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:2})}function _(e){return e.nodes.map((function(e){return e.RV}))}function O(e,t,n,r,o,a,i,s){if(e===n&&t===r||o===i&&a===s)return console.warn("Found line of length 0"),!1;var c=(s-a)*(n-e)-(i-o)*(r-t);if(0===c)return console.warn("Denominator is zero 0"),!1;var u=((i-o)*(t-a)-(s-a)*(e-o))/c,l=((n-e)*(t-a)-(r-t)*(e-o))/c;return!(u<0||u>1||l<0||l>1)&&{x:e+u*(n-e),y:t+u*(r-t)}}function S(e,t){for(var n=!1,r=0,o=[["tl","tr"],["tl","bl"],["tr","br"],["bl","br"]];r<o.length;r++){var a=o[r],i=a[0],s=a[1];if(n=O(e[i].x,e[i].y,e[s].x,e[s].y,t.src.x,t.src.y,t.dst.x,t.dst.y))break}return n||console.warn("Could not determine intersection"),n}var T=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).onNodeMove=function(e,t,n){r.nodeAttrsToState()},r.onNodeMoved=function(e,t,n){var o,a=Object(p.a)({},r.props.network),i=r.props.network_id,s=Object(f.a)(a.nodes);try{for(s.s();!(o=s.n()).done;){var c=o.value;if(c.RV===e){c.position=[t,n];break}}}catch(u){s.e(u)}finally{s.f()}E.saveNetwork(i,a)},r.onStateToggled=function(e,t){var n=Object(p.a)({},r.state.query);n[e]&&n[e]===t?delete n[e]:n[e]=t,r.query(n)},r.state={first_pass_complete:!1,node_centers:{},node_corners:{},query:{},probabilities:{}},r.myRefs={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.nodeAttrsToState(),this.query({})}},{key:"query",value:function(e){var t=this,n=this.props.network.id;E.queryNetwork(n,e).then((function(e){t.setState({query:e.query,probabilities:e.probabilities})}))}},{key:"nodeAttrsToState",value:function(){var e,t=_(this.props.network),n={},r={},o=Object(f.a)(t);try{for(o.s();!(e=o.n()).done;){var a=e.value,i=this.myRefs[a].current;n[a]=i.center,r[a]=i.corners}}catch(s){o.e(s)}finally{o.f()}this.setState({first_pass_complete:!0,node_centers:n,node_corners:r})}},{key:"computeEdge",value:function(e,t){var n=this.state,r=n.node_centers,o=n.node_corners,a=r[e],i=r[t],s=o[e],c=o[t];return{src:S(s,{src:a,dst:i}),dst:S(c,{src:a,dst:i})}}},{key:"renderEdges",value:function(){var e=this;return this.props.network.edges.map((function(t){var n=t[0],r=t[1],a=e.computeEdge(n,r),i=a.src,s=a.dst;return o.a.createElement(b,{key:"".concat(n,"_").concat(r),src:i,dst:s})}))}},{key:"render",value:function(){var e=this,t=this.props.network,n=this.state,r=n.first_pass_complete,a=n.query,i=n.probabilities,s=this.myRefs,c=_(t),u=t.nodes.reduce((function(e,t){return e[t.RV]=t,e}),{});return o.a.createElement("div",{className:"Network"},o.a.createElement("div",{className:"KonvaContainer"},o.a.createElement(g.Stage,{width:2042,height:1024},o.a.createElement(g.Layer,null,r&&this.renderEdges(),c.map((function(t){return s[t]=o.a.createRef(),o.a.createElement(v,{ref:s[t],key:t,node:u[t],query:a[t],probabilities:i[t],onDragMove:e.onNodeMove,onDragEnd:e.onNodeMoved,onStateToggled:e.onStateToggled})}))))))}}]),n}(r.Component);n(120);function x(e){return null}var N=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).onNetworkSelected=function(e){console.log("network ".concat(e," selected!")),E.getNetwork(e).then((function(t){var n=t.json;n.id=e,r.setState({network_id:e,network:n})}))},r.state={networks:[],network:null},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;E.getNetworks().then((function(t){console.log("App.componentDidMount(): ",t),t.length>0&&e.setState({networks:t},(function(){return e.onNetworkSelected(t[0].id)}))}))}},{key:"render",value:function(){var e=this.state,t=e.networks,n=e.network_id,r=e.network;return o.a.createElement("div",{className:"App"},o.a.createElement(x,null,"Header that displays "),o.a.createElement(d,{networks:t,onNetworkSelected:this.onNetworkSelected}),null===r&&o.a.createElement("span",null,"Loading ..."),r&&o.a.createElement(T,{key:r.id,network_id:n,network:r}),o.a.createElement(h,null))}}]),n}(r.Component),j={baseURL:""};Object({NODE_ENV:"production",PUBLIC_URL:"/static",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_BASEURL&&(j.baseURL=Object({NODE_ENV:"production",PUBLIC_URL:"/static",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_BASEURL);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));E.init(j),i.a.render(o.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},43:function(e,t,n){e.exports=n(121)},48:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){}},[[43,1,2]]]);
//# sourceMappingURL=main.af1c77e0.chunk.js.map